<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>Rob Gillen</title><link href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css"><link rel="stylesheet" href="/assets/site.css"><link rel="stylesheet" href="/assets/academicons.css"></head><body><div id="wrap"><div class="navbar navbar-default navbar-fixed-top"><div class="container"><div class="navbar-header"><button type="button" data-toggle="collapse" data-target=".navbar-collapse" class="navbar-toggle"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/" class="navbar-brand">Rob Gillen</a></div><div class="collapse navbar-collapse"><ul class="nav navbar-nav"><li><a href="/technology">Technology</a></li><li><a href="/presentations">Presentations/Talks</a></li><li><a href="/papers">Publications/Arcticles</a></li><li><a href="/projects">Projects</a></li><li><a href="/personal">Personal</a></li><li><a href="/about">About</a></li><li><a href="/contact">Contact</a></li><!--li.dropdown--><!--  a.dropdown-toggle(href="#", data-toggle="dropdown") Dropdown <b class="caret"></b>--><!--  ul.dropdown-menu--><!--    li--><!--      a(href="#") Action--><!--    li--><!--      a(href="#") Another action--><!--    li--><!--      a(href="#") Something else here--><!--    li.divider--><!--    li.dropdown-header Nav header--><!--    li--><!--      a(href="#") Separated link--><!--    li--><!--      a(href="#") One more separated link--></ul></div></div></div><div class="container"><div class="page-header"><h1>Using XSD in your C# and MPS programming...</h1></div><div class="row"><div class="col-md-9"><div class="panel"><div class="panel-body"><div class="row"><div class="col-md-12"><h5>January 14, 2006</h5><p>So I need to begin this post by admitting that I’m relatively new to the XSD world… particularly as it applies to C#.
While I’ve done a significant amount of Xml programming and manipulation in C#, my recent forays into this technology
cause me to reconsider my belief that I’m an experienced Xml programmer…</p>
<p>Lately I’ve been working both with team members at my company as well as some colleagues from other companies on the
topic of better and/or more consistent processing of the Xml used to pass data in and out of the MPF engine. It seems
that we all tend to be very comfortable working in an OO C# environment both at the layer above MPF
(presentation/application layer, etc.) as well as below the engine (providers).  It seems that we are frequently
performing the same operations (getting Xml nodes, performing validation steps, adding nodes to Xml documents, etc.)…
one would think that there could be some more consistent/reusable fashion… and we did… various libraries of different
sorts that we reused and extended on both sides of the engine.</p>
<p>I’ve been playing with an idea suggested to me by Mark which is to use XSD schemas to define the Xml “interfaces” and t
hen, utilizing xsd.exe, generating C# serializable classes to represent those Xml blobs. Then I can utilize the
serialization and de-serialization tools built into the .NET Framework to convert the C# objects into the input Xml
stream as well as to deserialize the return back into object form for normal processing. Further, I can use the new
validation features of a .NET 2.0 XmlTextReader (as compared to a 1.1 XmlValidatingReader) in conjunction with the Xsd
file used to generate the class to validate Xml input from external sources.</p>
<p>For the most part, this approach is very interesting to me and I’ve been using it on a project recently and been
increasingly pleased.  There are, however, a few things that I’m not completely pleased with… some of which I’ve found
workarounds for and others that are still open issues.</p>
<ul>
<li><p><strong>Documentation</strong> – One of the issues I ran into was a relative lack of documentation and online material on this
topic (found plenty of Xsd information in the context of DataSets, but not much in the way of custom serialization and
Xsd definitions which is why I’m writing this blog post (maybe it will be helpful to someone else looking for
information on the topic). I should note that I did find a fair amount of information on Xsd integration and
utilization but very few articles that discuss any .NET 2.0–specific features/issues.</p>
</li>
<li><p><strong>Auto Generation of Code</strong> – I was really hoping for some “magic” switch or property I could set on each of the Xsd
files in VS.NET that would cause VS.NET to automatically generate the C# from the Xsd for me (maybe at compile time?)
however, no such switch is to be found (at least not yet by me). Instead, I’ve been generating the XSD’s and then
shelling out to a command prompt to use the xsd.exe command line tool.</p>
</li>
<li><p><strong>Inability to “Decorate” XSD</strong> – I have actually found work-rounds to the items below, however they involve
manipulating the generated C# rather than modifying my XSD in some way to control the code generated by the output.
While my current approach works, it leaves me open to problems if/when I need to regenerate my C# due to updates to my
XSD.</p>
</li>
<li><p><strong>Casing</strong> – Another problem I ran into was that xsd.exe uses the element and attribute names from the schema to
generate the names for the C# objects and properties. The <em>problem</em> with this is that most of my Xml nodes are
camel-cased which results in C# class names that are camel-cased. This is inconsistent with our internal coding
standards (as well as FXCop rules) which require them to be pascal-cased.</p>
</li>
<li><p><strong>Naming</strong> – for similar reasons as the previous item, my generated C# classes ended up with some pretty interesting
names such as classes called <code>keykey</code> or <code>keypropertytype</code>. Probably more than the casing, it was important to me to
“fix” this problem so that the resultant code was legible for the next person working on this codebase.</p>
</li>
<li><p><strong>Arrays vs. List<t></t></strong> – Further complicating things is the fact that xsd.exe generates C# that uses strongly-typed
arrays for collections of nodes. While these definitely work, they seem “klugy” to me as I’ve gotten rather used to
<code>Add()</code> method of the ArrayList. Further, I’ve lately become very comfortably with strongly-typed lists (<code>List&lt;t&gt;</code>) in
.NET 2.0 and really would prefer to use that programming construct instead.</p>
</li>
</ul>
<p>I was able to work around the casing issue for switches by modifying the generated C# classes to match our coding
standards and then decorating them so that the XmlSerializer knows which Xml nodes to align with which classes. The
xsd.exe tool initially generated code that looked like the following:</p>
<pre><code>[System.Xml.Serialization.XmlElement()]
public key key
{
    get { return this.keyField; }
    set { this.keyField = value; }
}
</code></pre><p>I then updated the code and tweaked the decoration as follows to ge the casing the way I wanted…</p>
<pre><code>[System.Xml.Serialization.XmlElement(&quot;key&quot;)]
public Key Key
{
    get { return this.keyField; }
    set { this.keyField = value; }
}
</code></pre><p>What stumped me for a few minutes was how to handle the casing of the parent node of a collection (i.e. a node named
keys that has children named key). The compiler generated code that looks like</p>
<pre><code>[System.Xml.Serialization.XmlArrayItemAttribute(IsNullable = false)]
public key[] keys
{
    get { return this.keysField; }
    set { this.keysField = value; }
}
</code></pre><p>What I wanted, is a property called Keys (rather than keys).  There were two tricks I found here. The first was to
indicate the naming of the child nodes (“key”) which is accomplished by setting the <code>ElementName</code> property of the
<code>XmlArrayItemAttribute</code> as follows:</p>
<pre><code>[System.Xml.Serialization.XmlArrayItemAttribute(ElementName = &quot;key&quot;, IsNullable = false)]
</code></pre><p>The second step, is to decorate the property such that the the serializer knows that the <code>Key[]</code> array maps to the
<code>&lt;keys/&gt;</code> node. This is accomplished by adding an additional decoration to the property of type <code>XmlArray()</code> and
setting the constructor value. The following is the fully updated (at this stage) array property.</p>
<pre><code>[System.Xml.Serialization.XmlArray(&quot;keys&quot;)]
[System.Xml.Serialization.XmlArrayItemAttribute(ElementName = &quot;key&quot;, IsNullable = false)]
public Keys[] Keys
{
    get { return this.keysField; }
    set { this.keysField = value; }
}
</code></pre><p>Next I set to work on the array issue… I really wanted to be using strongly-typed lists (<code>List&lt;t&gt;</code>) which I figured
had to be possible. Come to find out, it is, and all you have to do is change the types (no further decoration
necessary) yielding an updated signature as follows:</p>
<pre><code>[System.Xml.Serialization.XmlArray(&quot;keys&quot;)]
[System.Xml.Serialization.XmlArrayItemAttribute(ElementName = &quot;key&quot;, IsNullable = false)]
public List&lt;Key&gt; Keys
{
    get { return this.keysField; }
    set { this.keysField = value; }
}
</code></pre><p>Finally, I wanted to address the naming issue… Looking at the steps I’d accomplished so far, I figured that the
decorations simply allow me to disassociate the C# class/property name from the Xml tag name and it proved to be
correct – in the same way that I was able to adjust for casing, I could adjust for naming changes.</p>
<p>At this point I had solved most of my problems so I continued working and will use it “as-is” for the time being… if
only I could have decorated the XSD so that these changes would be implemented as the code was generated…</p><!--a(href='#{ conf.web_link }') Conference Homepage--><!--each session in conf.sessions--><!--  .row--><!--    .col-xs-11--><!--      h4 #{ session.title }--><!--      p #{ session.abstract }--><!--      if session.assets--><!--        ul--><!--          each asset in session.assets--><!--            li--><!--              a(href='#{ asset.link }') #{ asset.title }--></div></div><hr><div id="disqus_thread"></div></div></div></div><div class="col-sm-3"><div class="panel panel-default"><div class="panel-heading">Recent Posts</div><div class="panel-body"><ul><li><a href="/technology/you-cant-handle-the-truth">You Can't Handle The Truth</a></li><li><a href="/technology/codestock-2014">CodeStock 2014</a></li><li><a href="/technology/tracking-planes-on-vacation">Tracking Planes on Vacation</a></li></ul></div></div><div class="panel panel-default"><div class="panel-heading">Older Posts</div><div class="panel-body"><ul><li><a href="/technology/2014/">2014 Posts</a></li><li><a href="/technology/2013/">2013 Posts</a></li><li><a href="/technology/2012/">2012 Posts</a></li><li><a href="/technology/2011/">2011 Posts</a></li><li><a href="/technology/2010/">2010 Posts</a></li><li><a href="/technology/2009/">2009 Posts</a></li><li><a href="/technology/2008/">2008 Posts</a></li><li><a href="/technology/2007/">2007 Posts</a></li><li><a href="/technology/2006/">2006 Posts</a></li><li><a href="/technology/2005/">2005 Posts</a></li><li><a href="/technology/2004/">2004 Posts</a></li></ul></div></div></div></div></div></div><div id="footer"><div class="container"><p class="text-muted credit"><a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png"></a> This work is licensed under a<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"> Creative Commons Attribution 4.0 International License</a>.</p></div></div><script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script><script type="text/javascript" src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script><script type="text/javascript" src="/assets/site.js"></script></body></html>