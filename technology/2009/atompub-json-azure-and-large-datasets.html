<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>Rob Gillen</title><link href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css"><link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Montserrat:400,700"><link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,700"><link rel="stylesheet" href="/assets/site.css"><link rel="stylesheet" href="/assets/academicons.css"></head><body><div id="wrap"><div class="navbar navbar-default navbar-fixed-top"><div class="container"><div class="navbar-header"><button type="button" data-toggle="collapse" data-target=".navbar-collapse" class="navbar-toggle"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/" class="navbar-brand">Rob Gillen</a></div><div class="collapse navbar-collapse"><ul class="nav navbar-nav"><li><a href="/technology">Technology</a></li><li><a href="/presentations">Talks</a></li><li><a href="/papers">Publications</a></li><li><a href="/projects">Projects</a></li><li><a href="/personal">Personal</a></li><li><a href="/about">About</a></li><li><a href="/contact">Contact</a></li><!--li.dropdown--><!--  a.dropdown-toggle(href="#", data-toggle="dropdown") Dropdown <b class="caret"></b>--><!--  ul.dropdown-menu--><!--    li--><!--      a(href="#") Action--><!--    li--><!--      a(href="#") Another action--><!--    li--><!--      a(href="#") Something else here--><!--    li.divider--><!--    li.dropdown-header Nav header--><!--    li--><!--      a(href="#") Separated link--><!--    li--><!--      a(href="#") One more separated link--></ul></div></div></div><div class="container"><div class="page-header"><h1 class="entry-title">AtomPub, JSON, Azure and Large Datasets</h1></div><div class="row"><div class="col-md-9"><div class="panel"><div class="panel-body"><div class="row"><div class="col-md-12"><h5>August 14, 2009</h5><p><strong>UPDATE 8/20/2009, 15:29 EST</strong>: There is some confusing content in this post (i.e. Azure storage doesn’t support JSON).
[A follow up to this post with further explanation/detail is available here]
(technology/2009/AtomPub-JSON-Azure-and-Large-Datasets-Part-2)</p>
<hr>
<p><strong>UPDATE 8/14/2009, 17:16 EST</strong>: <a href="https://twitter.com/smarx">@smarx</a> pointed out that this post is a bit misleading (my
word) in that Azure storage doesn’t support JSON. I have a web role in place that serves the data, which, upon
reflection could be introducing some time delays into the Atom feed. I will test further and update this post.</p>
<hr>
<p>I’m just really beginning to scratch the surface on my work on cloud computing and scientific computing but it seems
that nearly every day I’m able to spend time on this I come away with something at least moderately novel. Today’s
observation is, on reflection, a bit of a no-brainer but it wasn’t immediately obvious to me.</p>
<p>I’m kicking around some scientific data and have a single collection of data, with somewhere north of 40,000 subsets of
data, with each subset containing roughly 8,100 rows. I’ve had an interesting time getting this data into Azure tables,
but that’s not the point of this post. Once the data resided in Azure, I built a little ADO.NET client to pull the data
down based on various queries (in my case, a single “subset” at a time, or 8,100 rows). In case you are wondering, the
data is partitioned in Azure based on the key representing each subset, so I know that each query is only hitting a
single partition. I proceeded to follow the examples for paging and data calls (checking for continuation tokens, etc.)
and it wasn’t long before I had a client that would query for a particular slice of data, and then make however many
individual data calls necessary until the complete result set was downloaded and ready for processing. I was, however,
disappointed in the time it took to pull down a single slice of data… averages were around 55 seconds. Pulling down a
number of slices of the dataset, at nearly a minute each, was a bit slow.</p>
<p>I spent some time poking around with Fiddler and some other tools and discovered that I was suffering from XML bloat.
The “convenience” factor of having a common, easy-to-consume format was killing me. Each response coming back from the
server (1000 rows) was averaging over 1MB of XML.</p>
<p>After a while of kicking around my options (frankly, too long), I decided to try pulling the data as JSON. I hadn’t used
JSON previously, but had heard it touted as being very lightweight. I also found some nice libraries on [CodePlex]
(<a href="http://www.codeplex.com/">http://www.codeplex.com/</a>) for de-serializing the response so I could use it as I had the results of the Atom feed. Once
I made this change, I was shocked to see the amount of improvement (I expected some, but what I saw was much more than
anticipated). My average time dropped to around 14 seconds for the entire batch and the average size of the response
body dropped to about 163k.</p>
<p>I’ve included some charts below showing the results of my tests. I ran the tests 10 times for each of the approaches.
Code base for each test harness is identical with the exception of the protocol-specific text handling. Time
measurements are from the start of the query through the point that each response has been de-serialized into an
identical .NET object (actually, a <code>List&lt;T&gt;</code> objects).</p>
<p>These first two charts show the time required to retrieve the entire slice of data. The unit of measure is seconds.</p>
<p><img alt="chart04" src="/assets/images/image_19B74A6E.png" class="blogimage img-responsive"></p>
<p><img alt="chart05" src="/assets/images/image_74B989F4.png" class="blogimage img-responsive"></p>
<p>These charts show the average payload returned per request for the two different methods. In both cases, the unit of
measurement is bytes.</p>
<p><img alt="chart06" src="/assets/images/image_41E98380.png" class="blogimage img-responsive"></p>
<p><img alt="chart07" src="/assets/images/image_5FCA9832.png" class="blogimage img-responsive"></p><!--a(href='#{ conf.web_link }') Conference Homepage--><!--each session in conf.sessions--><!--  .row--><!--    .col-xs-11--><!--      h4 #{ session.title }--><!--      p #{ session.abstract }--><!--      if session.assets--><!--        ul--><!--          each asset in session.assets--><!--            li--><!--              a(href='#{ asset.link }') #{ asset.title }--></div></div><hr><div id="disqus_thread"></div></div></div></div><div class="col-sm-3"><div class="panel panel-default"><div class="panel-heading">Recent Posts</div><div class="panel-body"><ul><li><a href="/technology/2015/fighting_with_hidden_characters">Fighting with Hidden Characters</a></li><li><a href="/technology/2014/you-cant-handle-the-truth">You Can't Handle The Truth</a></li><li><a href="/technology/2014/codestock-2014">CodeStock 2014</a></li><li><a href="/technology/2014/tracking-planes-on-vacation">Tracking Planes on Vacation</a></li><li><a href="/technology/2014/book-review-learning-windows-mobile-services-for-win-8-and-win-phone-8">Book Review: Learning Windows Mobile Services for Win 8 and Win Phone 8</a></li><li><a href="/technology/2014/codemash-2014">CodeMash 2014</a></li></ul></div></div><div class="panel panel-default"><div class="panel-heading">Older Posts</div><div class="panel-body"><ul><li><a href="/technology/2015/">2015 Posts</a></li><li><a href="/technology/2014/">2014 Posts</a></li><li><a href="/technology/2013/">2013 Posts</a></li><li><a href="/technology/2012/">2012 Posts</a></li><li><a href="/technology/2011/">2011 Posts</a></li><li><a href="/technology/2010/">2010 Posts</a></li><li><a href="/technology/2009/">2009 Posts</a></li><li><a href="/technology/2008/">2008 Posts</a></li><li><a href="/technology/2007/">2007 Posts</a></li><li><a href="/technology/2006/">2006 Posts</a></li><li><a href="/technology/2005/">2005 Posts</a></li><li><a href="/technology/2004/">2004 Posts</a></li></ul></div></div></div></div></div></div><div id="footer"><div class="container"><p class="text-muted credit"><a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png"></a> This work is licensed under a<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"> Creative Commons Attribution 4.0 International License</a>.</p></div></div><script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script><script type="text/javascript" src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script><script type="text/javascript" src="/assets/site.js"></script></body></html>